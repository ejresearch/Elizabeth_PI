<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lizzy Prompt Studio - Brainstorm Configuration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@codemirror/view@6.0.0/dist/index.js"></script>
    <script src="https://unpkg.com/@codemirror/state@6.0.0/dist/index.js"></script>
    <script src="https://unpkg.com/@codemirror/commands@6.0.0/dist/index.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                        },
                        lizzy: {
                            pink: '#ff69b4',
                            purple: '#9370db',
                            blue: '#6495ed'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-lizzy {
            background: linear-gradient(135deg, #ff69b4 0%, #9370db 50%, #6495ed 100%);
        }
        .variable-tag {
            background: rgba(147, 112, 219, 0.1);
            border: 1px solid #9370db;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .prompt-section {
            border-left: 3px solid #ec4899;
            padding-left: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Header Bar -->
    <div class="gradient-lizzy text-white p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold">🎬 Lizzy Prompt Studio</h1>
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm">Brainstorm Configuration</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 hover:bg-white/20 rounded-lg transition">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                    </svg>
                </button>
                <button id="save-config" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">
                    Save Configuration
                </button>
                <button id="back-to-brainstorm" class="px-4 py-2 bg-white text-purple-700 hover:bg-gray-100 rounded-lg transition font-medium">
                    Back to Brainstorm
                </button>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="container mx-auto p-6">
        <div class="grid grid-cols-12 gap-6">
            
            <!-- Left Panel: Scene Context & Variables -->
            <div class="col-span-3">
                <!-- Current Scene Context -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">🎭</span> Current Scene Context
                    </h3>
                    <div id="scene-context" class="space-y-2 text-sm">
                        <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                            <span class="font-medium text-gray-600 dark:text-gray-400">Act:</span>
                            <span class="text-gray-800 dark:text-white ml-2">2</span>
                        </div>
                        <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                            <span class="font-medium text-gray-600 dark:text-gray-400">Scene:</span>
                            <span class="text-gray-800 dark:text-white ml-2">3</span>
                        </div>
                        <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                            <span class="font-medium text-gray-600 dark:text-gray-400">Characters:</span>
                            <div class="text-gray-800 dark:text-white mt-1">Emma, Jack</div>
                        </div>
                        <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                            <span class="font-medium text-gray-600 dark:text-gray-400">Key Events:</span>
                            <div class="text-gray-800 dark:text-white mt-1">Coffee shop meet-cute</div>
                        </div>
                        <div class="p-2 bg-gray-50 dark:bg-gray-700 rounded">
                            <span class="font-medium text-gray-600 dark:text-gray-400">Previous Scene:</span>
                            <div class="text-gray-800 dark:text-white mt-1">Emma's morning routine</div>
                        </div>
                    </div>
                </div>

                <!-- Available Variables -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">🔤</span> Template Variables
                    </h3>
                    <div class="space-y-2">
                        <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">Click to copy</div>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{context.act}">
                            <code class="text-purple-600 dark:text-purple-400">{context.act}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{context.scene}">
                            <code class="text-purple-600 dark:text-purple-400">{context.scene}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{context.scene_description}">
                            <code class="text-purple-600 dark:text-purple-400">{context.scene_description}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{character_details}">
                            <code class="text-purple-600 dark:text-purple-400">{character_details}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{logline}">
                            <code class="text-purple-600 dark:text-purple-400">{logline}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{previous_scene}">
                            <code class="text-purple-600 dark:text-purple-400">{previous_scene}</code>
                        </button>
                        <button class="variable-btn w-full text-left p-2 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded transition" data-var="{user_guidance}">
                            <code class="text-purple-600 dark:text-purple-400">{user_guidance}</code>
                        </button>
                    </div>
                </div>

                <!-- Bucket Configuration -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">📚</span> Knowledge Buckets
                    </h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                            <input type="checkbox" class="mr-2 text-purple-600" checked id="bucket-scripts">
                            <span class="text-gray-700 dark:text-gray-300">Scripts</span>
                            <span class="ml-auto text-xs text-gray-500">247 items</span>
                        </label>
                        <label class="flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                            <input type="checkbox" class="mr-2 text-purple-600" checked id="bucket-plays">
                            <span class="text-gray-700 dark:text-gray-300">Plays</span>
                            <span class="ml-auto text-xs text-gray-500">89 items</span>
                        </label>
                        <label class="flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                            <input type="checkbox" class="mr-2 text-purple-600" checked id="bucket-books">
                            <span class="text-gray-700 dark:text-gray-300">Books</span>
                            <span class="ml-auto text-xs text-gray-500">156 items</span>
                        </label>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                        <label class="text-sm text-gray-600 dark:text-gray-400">Query Mode</label>
                        <select class="w-full mt-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            <option value="mix">Mix (Hybrid)</option>
                            <option value="local">Local</option>
                            <option value="global">Global</option>
                            <option value="naive">Naive</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Center: Main Editor -->
            <div class="col-span-6">
                <!-- Tab Navigation -->
                <div class="bg-white dark:bg-gray-800 rounded-t-lg shadow-lg border-b border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-1 p-2">
                        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition active" data-tab="prompt">
                            Prompt Template
                        </button>
                        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition" data-tab="output">
                            Output Format
                        </button>
                        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition" data-tab="preview">
                            Live Preview
                        </button>
                        <button class="tab-btn px-4 py-2 rounded-lg font-medium transition" data-tab="versions">
                            Version History
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="bg-white dark:bg-gray-800 rounded-b-lg shadow-lg p-6">
                    <!-- Prompt Template Tab -->
                    <div id="prompt-tab" class="tab-content">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Template Name
                            </label>
                            <input type="text" id="template-name" value="Enhanced Scene Brainstorming" 
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Prompt Template
                                <span class="ml-2 text-xs text-gray-500">Use variables from the left panel</span>
                            </label>
                            <textarea id="prompt-template" rows="20" 
                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white font-mono text-sm"># Brainstorming with Lizzy

## General Instructions
You are **Lizzy**, an expert screenwriter specializing in romantic comedies. The goal of Brainstorm is to bring the ideas in the SQL tables to life and ground them in rich, real-world reference material from LightRAG.

## Scene Context
SCENE TO BRAINSTORM:
Act {context.act}, Scene {context.scene}

REQUIRED EVENTS:
{context.scene_description}

CHARACTERS IN SCENE:
{character_details}

PROJECT LOGLINE:
{logline}

PREVIOUS SCENE CONTEXT:
{previous_scene}

USER GUIDANCE:
{user_guidance}

## LightRAG Strategy
- Query each bucket sequentially for relevant insights
- Use mix mode for comprehensive coverage
- Extract tonal, thematic, and structural patterns
- Focus on concrete examples and proven techniques

## Output Requirements
Generate organized creative ideas following the structure defined in the Output Format tab.</textarea>
                        </div>

                        <div class="flex space-x-4">
                            <button class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition">
                                Validate Template
                            </button>
                            <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition">
                                Reset to Default
                            </button>
                        </div>
                    </div>

                    <!-- Output Format Tab -->
                    <div id="output-tab" class="tab-content hidden">
                        <h4 class="font-medium text-gray-800 dark:text-white mb-4">Required Output Sections</h4>
                        
                        <div class="space-y-4">
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">SQL Snapshot</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="5" min="1" max="10" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">bullet points</span>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ground truth from database</p>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Bucket Notes - Scripts</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="5" min="1" max="10" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">items with quotes</span>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Bucket Notes - Plays</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="5" min="1" max="10" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">items with quotes</span>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Bucket Notes - Books</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="5" min="1" max="10" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">items with quotes</span>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Unified Strategy</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="50" min="30" max="100" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">word limit</span>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Beat Sketch</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="8" min="6" max="12" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">beats</span>
                                    <div class="mt-2">
                                        <label class="text-xs text-gray-600 dark:text-gray-400">Beat Tags:</label>
                                        <div class="flex space-x-2 mt-1">
                                            <label class="text-xs"><input type="checkbox" checked> [Tone]</label>
                                            <label class="text-xs"><input type="checkbox" checked> [Plot]</label>
                                            <label class="text-xs"><input type="checkbox" checked> [Craft]</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Opportunities & Risks</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="6" min="4" max="10" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">total bullets</span>
                                </div>
                            </div>

                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" checked class="mr-2 text-purple-600">
                                    <span class="font-medium text-gray-800 dark:text-white">Open Questions</span>
                                </label>
                                <div class="ml-6 space-y-2">
                                    <input type="number" value="5" min="3" max="8" class="w-20 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">max questions</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Live Preview Tab -->
                    <div id="preview-tab" class="tab-content hidden">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">Raw Template</h4>
                                <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-sm font-mono overflow-auto max-h-96">
                                    <pre id="raw-preview">Loading...</pre>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 dark:text-white mb-2">Compiled with Data</h4>
                                <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-sm overflow-auto max-h-96">
                                    <pre id="compiled-preview">Loading...</pre>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-800 dark:text-white mb-2">Expected Output Structure</h4>
                            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm">
                                <div id="output-structure-preview"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Version History Tab -->
                    <div id="versions-tab" class="tab-content hidden">
                        <div class="space-y-3">
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="font-medium text-gray-800 dark:text-white">v2.1 - Current</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Enhanced with character details</p>
                                        <p class="text-xs text-gray-500 mt-1">Modified 2 hours ago</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded text-xs">
                                            Active
                                        </span>
                                        <button class="text-purple-600 hover:text-purple-700 text-sm">View</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="font-medium text-gray-800 dark:text-white">v2.0</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Added LightRAG integration</p>
                                        <p class="text-xs text-gray-500 mt-1">Modified yesterday</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="text-purple-600 hover:text-purple-700 text-sm">Restore</button>
                                        <button class="text-gray-600 hover:text-gray-700 text-sm">Compare</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="font-medium text-gray-800 dark:text-white">v1.0</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Initial brainstorm template</p>
                                        <p class="text-xs text-gray-500 mt-1">Modified 3 days ago</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="text-purple-600 hover:text-purple-700 text-sm">Restore</button>
                                        <button class="text-gray-600 hover:text-gray-700 text-sm">Compare</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition">
                                Create New Version
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Testing & Performance -->
            <div class="col-span-3">
                <!-- Quick Test -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">🧪</span> Quick Test
                    </h3>
                    
                    <div class="mb-3">
                        <label class="text-sm text-gray-600 dark:text-gray-400">Test Scene</label>
                        <select class="w-full mt-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            <option>Act 1, Scene 1 - Opening</option>
                            <option selected>Act 2, Scene 3 - Coffee Shop</option>
                            <option>Act 3, Scene 2 - Climax</option>
                        </select>
                    </div>
                    
                    <button id="run-test" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition">
                        Run Test
                    </button>
                    
                    <div id="test-status" class="mt-3 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm text-gray-600 dark:text-gray-400 hidden">
                        <div class="flex items-center">
                            <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                            </svg>
                            Testing prompt...
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">📊</span> Performance Metrics
                    </h3>
                    
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Output Compliance</span>
                                <span class="text-gray-800 dark:text-white font-medium">94%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">
                                <div class="bg-green-600 h-2 rounded-full" style="width: 94%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Response Time</span>
                                <span class="text-gray-800 dark:text-white font-medium">1.8s</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 75%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Creative Quality</span>
                                <span class="text-gray-800 dark:text-white font-medium">88%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">
                                <div class="bg-purple-600 h-2 rounded-full" style="width: 88%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs text-gray-500 dark:text-gray-400">Based on last 50 runs</p>
                    </div>
                </div>

                <!-- A/B Testing -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                    <h3 class="font-bold text-gray-800 dark:text-white mb-3 flex items-center">
                        <span class="mr-2">⚖️</span> A/B Testing
                    </h3>
                    
                    <div class="mb-3">
                        <label class="text-sm text-gray-600 dark:text-gray-400">Compare with</label>
                        <select class="w-full mt-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            <option>v2.0 - Previous version</option>
                            <option>v1.0 - Original template</option>
                            <option>Default Lizzy template</option>
                        </select>
                    </div>
                    
                    <button class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition mb-3">
                        Run Comparison
                    </button>
                    
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex items-center mb-1">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            Current wins: 8/10
                        </div>
                        <div class="flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            Comparison wins: 2/10
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 flex flex-col space-y-2">
        <button id="test-all-scenes" class="px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg shadow-lg transition flex items-center">
            <span class="mr-2">🎬</span> Test All Scenes
        </button>
        <button id="export-config" class="px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg shadow-lg transition flex items-center">
            <span class="mr-2">💾</span> Export Configuration
        </button>
    </div>

    <script>
        // Initialize with Python bridge capability
        window.pywebview = window.pywebview || {
            api: null
        };

        // Theme management
        const themeToggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        
        if (currentTheme === 'dark') {
            document.documentElement.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', theme);
        });

        // Tab management
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetTab = btn.dataset.tab;
                
                // Update button states
                tabButtons.forEach(b => {
                    b.classList.remove('bg-purple-100', 'dark:bg-purple-900/20', 'text-purple-700', 'dark:text-purple-300');
                    b.classList.add('text-gray-600', 'dark:text-gray-400');
                });
                btn.classList.remove('text-gray-600', 'dark:text-gray-400');
                btn.classList.add('bg-purple-100', 'dark:bg-purple-900/20', 'text-purple-700', 'dark:text-purple-300');
                
                // Update content visibility
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
                
                // Update preview if needed
                if (targetTab === 'preview') {
                    updatePreview();
                }
            });
        });

        // Set initial active tab
        document.querySelector('.tab-btn[data-tab="prompt"]').classList.add('bg-purple-100', 'dark:bg-purple-900/20', 'text-purple-700', 'dark:text-purple-300');
        document.querySelector('.tab-btn[data-tab="prompt"]').classList.remove('text-gray-600', 'dark:text-gray-400');

        // Variable insertion
        const variableButtons = document.querySelectorAll('.variable-btn');
        const promptTemplate = document.getElementById('prompt-template');

        variableButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const variable = btn.dataset.var;
                const cursorPos = promptTemplate.selectionStart;
                const textBefore = promptTemplate.value.substring(0, cursorPos);
                const textAfter = promptTemplate.value.substring(cursorPos);
                
                promptTemplate.value = textBefore + variable + textAfter;
                promptTemplate.focus();
                promptTemplate.setSelectionRange(cursorPos + variable.length, cursorPos + variable.length);
                
                // Flash feedback
                btn.classList.add('bg-purple-100', 'dark:bg-purple-800');
                setTimeout(() => {
                    btn.classList.remove('bg-purple-100', 'dark:bg-purple-800');
                }, 200);
            });
        });

        // Live preview update
        function updatePreview() {
            const template = document.getElementById('prompt-template').value;
            const rawPreview = document.getElementById('raw-preview');
            const compiledPreview = document.getElementById('compiled-preview');
            
            // Show raw template
            rawPreview.textContent = template;
            
            // Compile with sample data
            let compiled = template;
            const sampleData = {
                'context.act': '2',
                'context.scene': '3',
                'context.scene_description': 'Characters: Emma, Jack\nEvents: Coffee shop meet-cute',
                'character_details': 'EMMA (28, Female): Romantic challenge: Trust issues from past. Lovable trait: Infectious optimism. Comic flaw: Terrible at technology.\n\nJACK (30, Male): Romantic challenge: Workaholic tendencies. Lovable trait: Secret romantic. Comic flaw: Dad jokes.',
                'logline': 'A commitment-phobic event planner and a workaholic tech CEO discover love through a series of mistaken identity mix-ups',
                'previous_scene': 'Emma rushes through her morning routine, late for a client meeting',
                'user_guidance': 'Focus on witty dialogue and physical comedy'
            };
            
            Object.keys(sampleData).forEach(key => {
                compiled = compiled.replace(new RegExp(`{${key}}`, 'g'), sampleData[key]);
            });
            
            compiledPreview.textContent = compiled;
            
            // Update output structure preview
            updateOutputStructure();
        }

        function updateOutputStructure() {
            const outputPreview = document.getElementById('output-structure-preview');
            const sections = [];
            
            document.querySelectorAll('#output-tab input[type="checkbox"]:checked').forEach(checkbox => {
                const label = checkbox.parentElement.querySelector('.font-medium').textContent;
                sections.push(`✓ ${label}`);
            });
            
            outputPreview.innerHTML = sections.map(s => `<div class="mb-1">${s}</div>`).join('');
        }

        // Test functionality
        document.getElementById('run-test').addEventListener('click', async () => {
            const testStatus = document.getElementById('test-status');
            testStatus.classList.remove('hidden');
            testStatus.innerHTML = `
                <div class="flex items-center">
                    <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                    Testing prompt...
                </div>
            `;
            
            // Call Python backend if available
            if (window.pywebview && window.pywebview.api) {
                try {
                    const result = await window.pywebview.api.test_prompt(
                        document.getElementById('prompt-template').value,
                        document.querySelector('#test-scene select').value
                    );
                    
                    testStatus.innerHTML = `
                        <div class="text-green-600 dark:text-green-400">
                            ✓ Test completed successfully
                        </div>
                    `;
                } catch (error) {
                    testStatus.innerHTML = `
                        <div class="text-red-600 dark:text-red-400">
                            ✗ Test failed: ${error.message}
                        </div>
                    `;
                }
            } else {
                // Simulate test for demo
                setTimeout(() => {
                    testStatus.innerHTML = `
                        <div class="text-green-600 dark:text-green-400">
                            ✓ Test completed successfully (demo mode)
                        </div>
                    `;
                }, 2000);
            }
        });

        // Save configuration
        document.getElementById('save-config').addEventListener('click', async () => {
            const config = {
                templateName: document.getElementById('template-name').value,
                promptTemplate: document.getElementById('prompt-template').value,
                buckets: {
                    scripts: document.getElementById('bucket-scripts').checked,
                    plays: document.getElementById('bucket-plays').checked,
                    books: document.getElementById('bucket-books').checked
                },
                outputFormat: {},
                timestamp: new Date().toISOString()
            };
            
            // Collect output format settings
            document.querySelectorAll('#output-tab .border').forEach(section => {
                const checkbox = section.querySelector('input[type="checkbox"]');
                const numberInput = section.querySelector('input[type="number"]');
                if (checkbox && numberInput) {
                    const sectionName = checkbox.parentElement.querySelector('.font-medium').textContent;
                    config.outputFormat[sectionName] = {
                        enabled: checkbox.checked,
                        limit: parseInt(numberInput.value)
                    };
                }
            });
            
            if (window.pywebview && window.pywebview.api) {
                await window.pywebview.api.save_prompt_config(config);
                alert('Configuration saved!');
            } else {
                console.log('Configuration:', config);
                alert('Configuration saved (demo mode)');
            }
        });

        // Export configuration
        document.getElementById('export-config').addEventListener('click', () => {
            const config = {
                templateName: document.getElementById('template-name').value,
                promptTemplate: document.getElementById('prompt-template').value,
                version: '2.1',
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(config, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `lizzy_prompt_config_${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        // Back to brainstorm
        document.getElementById('back-to-brainstorm').addEventListener('click', () => {
            if (window.pywebview && window.pywebview.api) {
                window.pywebview.api.return_to_brainstorm();
            } else {
                alert('Returning to brainstorm canvas...');
            }
        });

        // Initialize preview on load
        updatePreview();
    </script>
</body>
</html>