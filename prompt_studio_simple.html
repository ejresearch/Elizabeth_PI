<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lizzy Prompt Builder - Simple</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #f8fafc;
            --panel: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --muted: #64748b;
            --accent: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .header p {
            font-size: 18px;
            color: var(--muted);
        }

        .builder {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 24px;
            height: calc(100vh - 180px);
        }

        .panel {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .panel-header {
            background: #f1f5f9;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 16px;
        }

        .panel-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        /* Data Blocks */
        .block-category {
            margin-bottom: 24px;
        }

        .block-category h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .data-block {
            display: block;
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 8px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 14px;
            color: var(--text);
        }

        .data-block:hover {
            background: #f1f5f9;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .data-block.sql {
            border-left: 4px solid var(--success);
        }

        .data-block.lightrag {
            border-left: 4px solid var(--warning);
        }

        .data-block.context {
            border-left: 4px solid var(--accent);
        }

        .block-label {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .block-desc {
            font-size: 12px;
            color: var(--muted);
        }

        /* Editor */
        .editor {
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 20px;
            border: none;
            background: var(--panel);
            color: var(--text);
            resize: none;
            width: 100%;
            height: 100%;
        }

        .editor:focus {
            outline: none;
        }

        /* Variable highlighting */
        .variable-highlight {
            background: #dbeafe;
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--accent);
            font-weight: 600;
        }

        /* Template buttons */
        .template-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .template-btn {
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--panel);
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-btn:hover {
            border-color: var(--accent);
            background: #f8fafc;
        }

        .template-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .template-desc {
            font-size: 12px;
            color: var(--muted);
        }

        /* Preview */
        .preview {
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            padding: 16px;
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Action buttons */
        .actions {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid var(--border);
            background: #f8fafc;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-secondary {
            background: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Lizzy Prompt Builder</h1>
            <p>Context engineering made stupidly simple</p>
        </div>

        <div class="builder">
            <!-- Left: Data Blocks -->
            <div class="panel">
                <div class="panel-header">üìä Data Blocks</div>
                <div class="panel-content">
                    
                    <div class="block-category">
                        <h3>üìã Templates</h3>
                        <div class="template-grid">
                            <div class="template-btn" onclick="loadTemplate('base')">
                                <div class="template-name">Base Brainstorm</div>
                                <div class="template-desc">Lizzy's standard brainstorming template</div>
                            </div>
                            <div class="template-btn" onclick="loadTemplate('comedy')">
                                <div class="template-name">Comedy Focus</div>
                                <div class="template-desc">Emphasizes humor and character flaws</div>
                            </div>
                            <div class="template-btn" onclick="loadTemplate('dialogue')">
                                <div class="template-name">Dialogue Heavy</div>
                                <div class="template-desc">For conversation-driven scenes</div>
                            </div>
                        </div>
                    </div>

                    <div class="block-category">
                        <h3>üóÑÔ∏è SQL Data</h3>
                        <button class="data-block sql" onclick="insertBlock('sql.scene.events')">
                            <div class="block-label">Scene Events</div>
                            <div class="block-desc">Key events from story_outline</div>
                        </button>
                        <button class="data-block sql" onclick="insertBlock('sql.characters.challenges')">
                            <div class="block-label">Character Challenges</div>
                            <div class="block-desc">Romantic challenges from characters table</div>
                        </button>
                        <button class="data-block sql" onclick="insertBlock('sql.characters.traits')">
                            <div class="block-label">Character Traits</div>
                            <div class="block-desc">Lovable traits for each character</div>
                        </button>
                        <button class="data-block sql" onclick="insertBlock('sql.characters.flaws')">
                            <div class="block-label">Character Flaws</div>
                            <div class="block-desc">Comedic flaws for humor beats</div>
                        </button>
                        <button class="data-block sql" onclick="insertBlock('sql.scene.location')">
                            <div class="block-label">Scene Location</div>
                            <div class="block-desc">Physical setting from database</div>
                        </button>
                        <button class="data-block sql" onclick="insertBlock('sql.previous.scene')">
                            <div class="block-label">Previous Scene</div>
                            <div class="block-desc">Continuity from last scene</div>
                        </button>
                    </div>

                    <div class="block-category">
                        <h3>üìö LightRAG</h3>
                        <button class="data-block lightrag" onclick="insertBlock('lightrag.scripts.dialogue')">
                            <div class="block-label">Script Dialogue</div>
                            <div class="block-desc">Witty exchanges from romcom scripts</div>
                        </button>
                        <button class="data-block lightrag" onclick="insertBlock('lightrag.scripts.beats')">
                            <div class="block-label">Script Beats</div>
                            <div class="block-desc">Pacing and rhythm examples</div>
                        </button>
                        <button class="data-block lightrag" onclick="insertBlock('lightrag.plays.archetypes')">
                            <div class="block-label">Character Archetypes</div>
                            <div class="block-desc">Classic character patterns from plays</div>
                        </button>
                        <button class="data-block lightrag" onclick="insertBlock('lightrag.books.structure')">
                            <div class="block-label">Story Structure</div>
                            <div class="block-desc">Craft techniques from writing books</div>
                        </button>
                        <button class="data-block lightrag" onclick="insertBlock('lightrag.books.comedy')">
                            <div class="block-label">Comedy Techniques</div>
                            <div class="block-desc">Humor principles and methods</div>
                        </button>
                    </div>

                    <div class="block-category">
                        <h3>üéØ Context</h3>
                        <button class="data-block context" onclick="insertBlock('context.project.logline')">
                            <div class="block-label">Project Logline</div>
                            <div class="block-desc">Main story premise</div>
                        </button>
                        <button class="data-block context" onclick="insertBlock('context.session.history')">
                            <div class="block-label">Session History</div>
                            <div class="block-desc">Previous brainstorm successes</div>
                        </button>
                        <button class="data-block context" onclick="insertBlock('context.user.guidance')">
                            <div class="block-label">User Guidance</div>
                            <div class="block-desc">Specific directions for this session</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Center: Editor -->
            <div class="panel">
                <div class="panel-header">‚úèÔ∏è Prompt Editor</div>
                <textarea id="prompt-editor" class="editor" placeholder="Start with a template (left) or write your own prompt...

Click data blocks to insert context variables.

Your prompt will compile with real project data when used for brainstorming."></textarea>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="clearEditor()">Clear</button>
                    <button class="btn btn-secondary" onclick="previewPrompt()">Preview</button>
                    <button class="btn btn-primary" onclick="savePrompt()">Save</button>
                    <button class="btn btn-success" onclick="startBrainstorm()">‚Üí Brainstorm</button>
                </div>
            </div>

            <!-- Right: Preview & Info -->
            <div class="panel">
                <div class="panel-header">üëÅÔ∏è Live Preview</div>
                <div class="panel-content">
                    <div id="preview-area" class="preview">
Click "Preview" to see your prompt compiled with sample data...
                    </div>
                    
                    <h3 style="margin: 24px 0 12px; font-size: 16px;">üéØ Current Project</h3>
                    <div style="background: #f8fafc; padding: 12px; border-radius: 6px; font-size: 14px; margin-bottom: 16px;">
                        <strong>Project:</strong> <span id="project-name">gamma</span><br>
                        <strong>Characters:</strong> Emma, Jake, Maya<br>
                        <strong>Active Buckets:</strong> <span style="color: var(--success);">3 connected</span>
                    </div>

                    <h3 style="margin: 24px 0 12px; font-size: 16px;">üí° Tips</h3>
                    <ul style="font-size: 14px; color: var(--muted); line-height: 1.6;">
                        <li>Start with a template for the basic structure</li>
                        <li>Add SQL blocks for project-specific context</li>
                        <li>Use LightRAG blocks for research material</li>
                        <li>Context blocks add user guidance and history</li>
                        <li>Preview shows how variables will be filled</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const templates = {
            base: `# Brainstorming with Lizzy

## Scene Context
SCENE LOCATION: {sql.scene.location}
CHARACTERS: {sql.scene.characters} 
EVENTS: {sql.scene.events}

## Character Intelligence  
CHALLENGES: {sql.characters.challenges}
TRAITS: {sql.characters.traits}
FLAWS: {sql.characters.flaws}

PREVIOUS SCENE: {sql.previous.scene}

## Research Strategy
- Query {lightrag.scripts.dialogue} for comparable moments
- Extract emotional patterns from {lightrag.plays.archetypes}  
- Apply craft techniques from {lightrag.books.structure}

## Project Context
LOGLINE: {context.project.logline}
USER GUIDANCE: {context.user.guidance}

## Output
1. **SQL Snapshot** (3-5 bullets from database)
2. **Research Notes** (5 bullets from LightRAG)  
3. **Beat Sketch** (6-8 numbered beats)
4. **Open Questions** (3-5 issues to resolve)

Generate organized creative ideas focusing on possibility and inspiration.`,

            comedy: `# Comedy Brainstorming for Scene

## Character Comedy Setup
CHARACTERS: {sql.scene.characters}
COMEDIC FLAWS: {sql.characters.flaws} 
LOVABLE TRAITS: {sql.characters.traits}

## Comedy Research
- Mine {lightrag.scripts.dialogue} for witty exchanges
- Study {lightrag.books.comedy} for humor principles
- Apply character comedy from {lightrag.plays.archetypes}

## Scene Context
LOCATION: {sql.scene.location}
EVENTS: {sql.scene.events}
CHALLENGES: {sql.characters.challenges}

## Comedy Output
1. **Character Flaw Comedy** (how flaws create laughs)
2. **Dialogue Samples** (witty exchanges)
3. **Physical Comedy** (based on location/events)
4. **Comedy Beats** (setup/punchline structure)
5. **Running Gags** (callback opportunities)

Focus on character-driven humor that advances the story.`,

            dialogue: `# Dialogue-Focused Brainstorming

## Character Voices
{sql.characters.traits}
{sql.characters.flaws}
{sql.characters.challenges}

## Dialogue Research
Query {lightrag.scripts.dialogue} for:
- Subtext techniques
- Character voice differentiation  
- Witty banter patterns

Reference {lightrag.plays.archetypes} for:
- Character speech patterns
- Dramatic dialogue techniques

## Scene Setup
LOCATION: {sql.scene.location}
EVENTS: {sql.scene.events}
CONTEXT: {context.user.guidance}

## Dialogue Output
1. **Voice Samples** (each character's distinct style)
2. **Subtext Examples** (what they mean vs. say)
3. **Conflict Exchanges** (tension through dialogue)
4. **Humor Beats** (comedic dialogue moments)
5. **Emotional Moments** (vulnerability through speech)

Generate dialogue ideas that reveal character while advancing plot.`
        };

        const sampleData = {
            'sql.scene.location': 'Cozy neighborhood coffee shop',
            'sql.scene.characters': 'Emma Chen, Jake Rodriguez', 
            'sql.scene.events': 'Accidental coffee spill leads to meet-cute conversation',
            'sql.characters.challenges': 'Emma: Trust issues from past betrayal, Jake: Fear of putting himself out there',
            'sql.characters.traits': 'Emma: Witty food blogger, Jake: Passionate about authentic cooking',
            'sql.characters.flaws': 'Emma: Judges people too quickly, Jake: Stubborn and proud',
            'sql.previous.scene': 'Emma rushing to important meeting',
            'lightrag.scripts.dialogue': '[Query results: Witty exchanges from When Harry Met Sally, dialogue timing from romcom classics]',
            'lightrag.plays.archetypes': '[Query results: Character dynamics from Shakespeare comedies, archetypal patterns]',
            'lightrag.books.structure': '[Query results: Beat structure from Save the Cat, scene pacing techniques]',
            'lightrag.books.comedy': '[Query results: Comedy principles from humor writing guides]',
            'context.project.logline': 'Food blogger and chef discover love through culinary clashes and cultural connections',
            'context.user.guidance': 'Focus on authentic chemistry, avoid clich√© meet-cute tropes',
            'context.session.history': '[Previous session identified successful witty banter patterns]'
        };

        function insertBlock(blockKey) {
            const editor = document.getElementById('prompt-editor');
            const cursorPos = editor.selectionStart;
            const textBefore = editor.value.substring(0, cursorPos);
            const textAfter = editor.value.substring(cursorPos);
            
            const variable = `{${blockKey}}`;
            editor.value = textBefore + variable + textAfter;
            editor.focus();
            editor.setSelectionRange(cursorPos + variable.length, cursorPos + variable.length);
        }

        function loadTemplate(templateName) {
            const editor = document.getElementById('prompt-editor');
            editor.value = templates[templateName] || '';
        }

        function clearEditor() {
            document.getElementById('prompt-editor').value = '';
        }

        function previewPrompt() {
            const editor = document.getElementById('prompt-editor');
            const preview = document.getElementById('preview-area');
            
            let compiled = editor.value;
            
            // Replace variables with sample data
            Object.entries(sampleData).forEach(([key, value]) => {
                const regex = new RegExp(`{${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}}`, 'g');
                compiled = compiled.replace(regex, value);
            });
            
            preview.textContent = compiled || 'No prompt to preview...';
        }

        function savePrompt() {
            const editor = document.getElementById('prompt-editor');
            const promptName = prompt('Name this prompt template:');
            if (promptName && editor.value.trim()) {
                // In real app, save to database
                console.log('Saving prompt:', promptName, editor.value);
                alert(`‚úÖ Prompt "${promptName}" saved!`);
            }
        }

        function startBrainstorm() {
            const editor = document.getElementById('prompt-editor');
            if (!editor.value.trim()) {
                alert('Please create a prompt first!');
                return;
            }
            
            // In real app, pass to brainstorm system
            console.log('Starting brainstorm with prompt:', editor.value);
            alert('üöÄ Starting brainstorm session with your custom prompt!\n\n(In real app, this would launch the brainstorm interface)');
        }

        // Initialize with base template
        document.addEventListener('DOMContentLoaded', () => {
            loadTemplate('base');
        });
    </script>
</body>
</html>